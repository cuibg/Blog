## 虚拟内存

虚拟内存又叫`虚拟存储器（Virtual Memory）`，是现代操作系统进行内存管理的一种技术。
虚拟内存主要做以下几件事：

* 1、为每个进程提供4GB独立的虚拟存储空间

虚拟内存机制会在每个进程启动时为其分配一个的4GB（32位系统）的连续虚拟内存空间。但并不是说这个进程就占用了全部4GB的RAM，而是该进程的最大寻址范围是4GB。

对于进程来说，不需要关心是不是真的有那么多可用的实际内存，每当进程访问虚拟内存中的一块地址空间时，操作系统都会为其做一个地址映射，找到该虚拟内存地址在实际内存上对应的地址。

* 2、为每个进程提供连续的存储空间

进程不需要关心自己操作的虚拟存储空间在RAM上是怎么存储的，是否连续存储，操作系统会为我们处理好这件事。

* 3、必要时将RAM中数据保存到磁盘上

当RAM可用空间不足时，操作系统会将其中暂时不用的数据迁移到磁盘上，被迁出的部分等到使用的时候会再次迁入内存。

大部分操作系统，Windows、Linux、OS X都提供了类似上述的虚拟内存技术。

iOS也使用虚拟内存技术，但略有区别。iOS不会在RAM空间不足时将数据迁移到磁盘上，而是要求进程自己释放掉暂时不用的内存，如果释放不及时或者释放后依然内存不足，进程就会被系统杀死。这就是传说中的Memory Warning机制。

iOS为什么不使用PC系统中类似的虚拟内存技术？个人猜测可能由以下两个原因：

* 1、CPU性能低

是因为iPhone上的CPU和PC上的CPU性能差太多，而不管是将内存中的数据缓存到磁盘上还是将磁盘中的缓存再加载到内存中，需要消耗大量的CPU。RAM的存取时间要比磁盘快上千倍，缓存起来手机不得卡死。而PC上CPU性能较高，一定程度上能缓解这个问题。

* 2、内存容量低

iPhone上的内存容量太低，从最初的256MB到512MB再到现在的1GB，哪怕和Android机都差得远，更别说PC了。如果使用内存不足就将数据缓存到磁盘的方式，而不是限制进程对内存的使用，很可能导致内存数据都缓存了也不够用的悲剧。所以，还是从源头上根治吧，压根就不允许进程无休止的内存占用。
